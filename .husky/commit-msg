COMMIT_MESSAGE_FILE=$1
COMMIT_MESSAGE=$(cat "$COMMIT_MESSAGE_FILE")

# PR Merge Commit ë©”ì‹œì§€ ê°ì§€ ë° ìˆ˜ì •
if echo "$COMMIT_MESSAGE" | grep -qE "^Merge pull request"; then
  PR_NUMBER=$(echo "$COMMIT_MESSAGE" | grep -oE "#[0-9]+")
  PR_TITLE=$(echo "$COMMIT_MESSAGE" | sed -nE 's/^Merge pull request #[0-9]+ from [^:]+:?[[:space:]]*(.*)/\1/p')
  NEW_MESSAGE=":twisted_rightward_arrows: Merge $PR_NUMBER: $PR_TITLE"
  echo "$NEW_MESSAGE" > "$COMMIT_MESSAGE_FILE"
  exit 0
fi

# semantic-releaseì˜ ì»¤ë°‹ ë©”ì‹œì§€ ìë™ ì²˜ë¦¬
if echo "$COMMIT_MESSAGE" | grep -qE "^chore\(release\): .+"; then
  NEW_MESSAGE=":tada: $COMMIT_MESSAGE"
  echo "$NEW_MESSAGE" > "$COMMIT_MESSAGE_FILE"
  exit 0
fi

# gitmoji ìë™ ì²˜ë¦¬: chore, fix, feat, docs ë“±
if echo "$COMMIT_MESSAGE" | grep -qE "^\w+"; then
  COMMIT_TYPE=$(echo "$COMMIT_MESSAGE" | grep -oE "^\w+" | head -n 1)

  case "$COMMIT_TYPE" in
    chore)
      NEW_MESSAGE=":wrench: $COMMIT_MESSAGE"
      ;;
    fix)
      NEW_MESSAGE=":bug: $COMMIT_MESSAGE"
      ;;
    feat)
      NEW_MESSAGE=":sparkles: $COMMIT_MESSAGE"
      ;;
    docs)
      NEW_MESSAGE=":memo: $COMMIT_MESSAGE"
      ;;
    style)
      NEW_MESSAGE=":art: $COMMIT_MESSAGE"
      ;;
    refactor)
      NEW_MESSAGE=":recycle: $COMMIT_MESSAGE"
      ;;
    test)
      NEW_MESSAGE=":test_tube: $COMMIT_MESSAGE"
      ;;
    *)
      NEW_MESSAGE="$COMMIT_MESSAGE"
      ;;
  esac

  echo "$NEW_MESSAGE" > "$COMMIT_MESSAGE_FILE"
  exit 0
fi

# ì»¤ë°‹ ë©”ì‹œì§€ ê·œì¹™ ê²€ì¦
if ! echo "$COMMIT_MESSAGE" | grep -qE "^:[a-zA-Z]+: .+"; then
  echo "âŒ Please use gitmoji in your commit message"
  echo "Commit message should follow the pattern: ^:[a-zA-Z]+: .+"
  exit 1
fi

echo "ğŸ Thanks for keeping the convention ğŸ"
